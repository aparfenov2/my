<schema>

<!-- Генерация UI: Схема сериализуется в нативный формат через генератор. Интерфейс строит нативная фабрика -->

<!-- Единицы измерения -->
	<units>
		<unit id="mhz_ut">
			<unit multiplier="1000000" name="MHz"/>
			<unit multiplier="1000" name="KHz"/>
			<unit multiplier="1" name="Hz"/>
		</unit>
	</units>


	<types>
<!-- опишем простые типы, чтобы их можно было найти -->	
		<type id="string" type="base" />
		<type id="float" type="base" />
		<type id="u8" type="base" />
		<type id="s8" type="base" />
		<type id="u16" type="base" />
		<type id="s16" type="base" />
		<type id="u32" type="base" />
		<type id="s32" type="base" />
		
		<type id="dme_sfx_t" name="Суффикс DME" type="enum">
			<enum id="X" name="X" value="0" />
			<enum id="Y" name="Y" value="1" />
		</type>
		
		<!-- Использование полей параметра комплексного типа полностью определяется контроллером -->
		<!-- поэтому здесь для полей вид не указан -->
		<type id="dme_t" name="Параметры DME" type="complex">
			<parameter id="ch" name="Канал DME" type="u8" validator="range" initial="127" lo="-127" hi="128" increment="1" />
			<parameter id="sfx" name="Суффикс DME" type="dme_sfx_t" initial="0" />
		</type>
		<type id="measure_ctl_t" name="Измерение" type="enum">
			<enum id="START" name="Старт" value="0" glyph="A" />
			<enum id="STOP" name="Стоп" value="1" glyph="B" />
		</type>
		<type id="on_off_t" name="xxx" type="enum">
			<enum id="ON" name="ON" value="0"  />
			<enum id="OFF" name="OFF" value="1"  />
		</type>
		<type id="output_mode_t" name="Выход" type="enum">
			<enum id="ANT" name="Антенна" value="0"  />
			<enum id="ATTEN" name="Аттен." value="1"  />
			<enum id="CALIB" name="Калибр." value="2"  />
		</type>
		<type id="start_ctl_t" name="Запуск" type="enum">
			<enum id="HIP" name="ХИП" value="0" />
			<enum id="CALIB" name="Пачка" value="1"  />
			<enum id="EXT" name="Внеш" value="2" />
		</type>
		<type id="mode_ctl_t" name="Режим" type="enum">
			<enum id="REQESTER" name="Запросчик" value="0"  />
			<enum id="RESPONDER" name="Ответчик" value="1"  />
		</type>
		<type id="dsp_onoff_t" name="Отключение дисплея" type="enum">
			<enum id="NO" name="НЕТ" value="0" />
			<enum id="a1_MIN" name="1 МИНУТА" value="0"  />
			<enum id="a5_MIN" name="5 МИНУТ" value="1"  />
			<enum id="a10_MIN" name="10 МИНУТ" value="2"  />
		</type>
	</types>
	
	<parameters>
<!-- Главное -->
		<parameter id="dme" type="dme_t"  name="Параметры DME" view="dme"  />
		<parameter id="measure_ctl" type="measure_ctl_t"  name="Измерение" initial="0" />
		<parameter id="output_mode" type="output_mode_t"  name="Выход" initial="0"  />
		<parameter id="out_level" type="float" increment="0.1" validator="range" lo="-70.0" hi="70.0" initial="69.3"  name="Уровень" label="dBm" view="tbox_label" />
		<parameter id="start_ctl" type="start_ctl_t"  name="Запуск" initial="0"  />
		
<!-- Параметры -->	
		<parameter id="req_period" type="u32" name="Период запросов" initial="1300" increment="1" label="Имп. пар\\с" view="tbox_label" />
		<parameter id="req_freq" type="float" name="Частота запроса" initial="1050.20" increment="0.1" label="Мгц" view="tbox_label" />
		<parameter id="req_span" type="float" name="Кодовый интервал запроса" initial="12.0" increment="0.1" label="мкс" view="tbox_label" />
		<parameter id="rsp_span" type="float" name="Кодовый интервал ответа" initial="12.0" increment="0.1" label="мкс" view="tbox_label" />
		<parameter id="mode_ctl" type="mode_ctl_t"  name="Режим" initial="0"  />
		
<!-- Экран -->	
		<parameter id="brightness" type="u8" name="Яркость" initial="100" increment="10" label="%" view="tbox_label" />
		<parameter id="dsp_onoff" type="dsp_onoff_t" name="Отключение дисплея" initial="0" />
<!-- Test -->	
		<parameter id="str_foo" type="string" name="Foo" initial="abc" />
		<parameter id="header_freq" type="float" initial="1.001" increment="0.001" label="GHz" view="tbox_label" />
		<parameter id="header_level" type="float" initial="13.00" increment="0.1" label="dBm" view="tbox_label" />
		
		<parameter id="rf_on" type="on_off_t" initial="1" name="RF"  />
		<parameter id="mod_off" type="on_off_t" initial="0" name="MOD" />
	</parameters>
	
	<colors>
		<color id="BK_WHITE" hex="0xF9FFF4"/>
		<color id="BK_BLUE" hex="0x679AB9"/>
		<color id="BK_GRAY" hex="0x97A39F"/>
		<color id="FNT_WHITE" hex="0xE5E9F2"/>
		<color id="SELECTED" hex="0xAFBFCF"/>
		<color id="CAPTURED" hex="0x267F00"/>
		<color id="INVALID" hex="0xFF0000"/>
		<color id="BLACK" hex="0x000000"/>
	</colors>
	
	<fonts>
		<font id="TTF" name="ARIALN.TTF" default="true" />
		<font id="TTF_BOLD" name="ARIALNB.TTF" />
		<font id="GLY" name="glyphs.ttf" />
	</fonts>
	
	<font_sizes>
		<font_size id="FS_8" value="12" />
		<font_size id="FS_15" value="16" />
		<font_size id="FS_20" value="21" default="true"/>
		<font_size id="FS_30" value="30" />
	</font_sizes>

	<views>
<!-- предопределенные (в коде) виды. Для них также создается мета -->
		<view id="lab" controller="lab" predefined="lab" font="TTF" font_size="FS_30" /> <!-- label -->
		
		<view id="tbox" predefined="tbox" controller="tbox" font_size="FS_30" decorator="background,3d" 
			default_color="BK_WHITE" selected_color="SELECTED" captured_color="CAPTURED" invalid_color="INVALID" /> <!-- textbox -->
			
		<view id="cbox" predefined="cbox" controller="cbox" font_size="FS_30" decorator="background,3d,cbox" 
			default_color="BK_WHITE" selected_color="SELECTED" captured_color="CAPTURED" /> <!-- combobox -->
			
		<view id="btn" controller="btn" predefined="btn" layout="center" padding="10"
			decorator="background,3d" d3_inversed="true"  default_color="BK_WHITE" selected_color="SELECTED" > <!-- button \-->
			<view inherited="lab" font_size="FS_20" static_text="btn" />
		</view>
		
<!-- textbox + combobox -->		
		<view id="tbox_cbox" layout="stack" vertical="false" > 
			<view inherited="tbox" />
			<view inherited="cbox" />
		</view>
<!-- textbox + label -->
		<view id="tbox_label" layout="stack" vertical="false" >
			<view inherited="tbox" />
			<view inherited="lab" text_source="label" /> <!-- взять значение label из аттрибута label, а не name -->
		</view>
		
		<view id="status_label" layout="center" propagate="parameter_path" >
			<view layout="stretch" padding="2" propagate="parameter_path" decorator="background,box" default_color="BK_WHITE" box_color="BLACK">
				<view layout="stack" vertical="false" propagate="parameter_path" >
					<view inherited="lab" text_source="name" font_size="FS_8" />
					<view inherited="lab" dynamic_source="parameter_value" font_size="FS_8" /> <!-- взять значение label из значения связанного параметра -->
				</view>	
			</view>
		</view>


<!-- генерируемые виды -->
		<view id="dme" layout="stack" vertical="false" > 
			<view inherited="tbox" parameter_path=".ch" /> <!-- относительный путь внутри параметра dme -->
			<view inherited="cbox" parameter_path=".sfx" />
		</view>

		
		<view id="default_composite_template" layout="stack" vertical="true"/>
<!-- popup demo
		<view id="popup_demo" layout="center">
			<view  inherited="btn" name="Нажми" popup_view="foo_popup" />
		</view>
		
		<view id="foo_popup" layout="center">
			<view  layout="center"  decorator="background" default_color="BK_BLUE" width="300" height="200" >
				<view  layout="stack" vertical="true"  >
					<view  inherited="lab" static_text="Сообщение 1" />
					<view  inherited="btn" name="Закрыть" close="true" />
				</view>
			</view>
		</view>
-->
<!-- propagate - передать параметр непосредственным детям-->

		<view id="root" layout="stretch" padding="5" decorator="background" default_color="BK_GRAY">
			<view layout="stack" vertical="true"  stretch_last="true" >
				<view layout="stack" vertical="false" stretch_last="true" >
					<view layout="stretch" controller="parameter_view" parameter_path="header_freq"/> 
					<view layout="stretch" controller="parameter_view" parameter_path="header_level"/> 

					<view layout="right_bottom" vertical="false">
						<view layout="stack" vertical="false">
							<view inherited="status_label" parameter_path="rf_on" propagate="parameter_path" />
							<view inherited="status_label" parameter_path="mod_off" propagate="parameter_path" />
						</view>
					</view>
				</view>

				<view layout="stack" vertical="true"  stretch_last="true">
					<view decorator="background" default_color="BK_BLUE" layout="stretch">
						<view inherited="lab" static_text="xxx" listen="menu_name" font="TTF_BOLD" font_size="FS_8" font_color="FNT_WHITE"  /> 
					</view>
					<view predefined="scroll_window" >
						<view layout="stretch" padding="10" >
	<!-- параметры event, listen, arg0 - посылка сообщения по локальной шине сообщений -->
							<view initial="main" layout="stretch" controller="window_selector" listen="menu_select" event="menu_name" >
								<view id="main" name="Главное" layout="center" >
									<view layout="stack" vertical="false" preferred_item_size="false" bw="140" height="80" >
										<view layout="center" decorator="background" default_color="BK_BLUE" >
											<view inherited="btn" name="Управление" event="menu_select" arg0="control" />
										</view>
										<view layout="center" decorator="background" default_color="BK_BLUE">
											<view inherited="btn" name="Калибровка" event="menu_select" arg0="parameters" />
										</view>
										<view layout="center" decorator="background" default_color="BK_BLUE">
											<view inherited="btn" name="Настройки"  event="menu_select" arg0="settings" />
										</view>
									</view>
								</view>
								<view id="control" name="Управление" menu_ref="main" item_template_view="menu_item" layout="stack" vertical="true"  controller="menu" />
								<view id="parameters" name="Калибровка" menu_ref="parameters" item_template_view="menu_item" layout="stack" vertical="true"  controller="menu" />
								<view id="settings" name="Настройки" menu_ref="screen" item_template_view="menu_item" layout="stack" vertical="true"  controller="menu" />
							</view>
						</view>
					</view>
				</view>
			</view>
		</view>
		
		
		<view id="menu_item" layout="menu_item" ratio="0.5">
			<view inherited="lab" text_source="name" /> <!-- взять параметр "name" из меты параметра -->
			<!-- элемент меню вставляется дочерним видом (реализация зависит от контроллера меню) -->
		</view>
	</views>
	
	<menus>
		<menu id="main">
			<parameter_ref id="measure_ctl" />
			<parameter_ref id="dme" />
			<parameter_ref id="output_mode" />
			<parameter_ref id="out_level" />
			<parameter_ref id="start_ctl" />
		</menu>
		<menu id="parameters">
			<parameter_ref id="req_period" />
			<parameter_ref id="req_freq" />
			<parameter_ref id="req_span" />
			<parameter_ref id="rsp_span" />
			<parameter_ref id="mode_ctl" />
			
			<parameter_ref id="brightness" />
			<parameter_ref id="dsp_onoff" />
		</menu>
		<menu id="screen">
			<parameter_ref id="brightness" />
			<parameter_ref id="dsp_onoff" />
		</menu>
	</menus>
</schema>