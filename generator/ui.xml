<schema>

<!-- Генерация UI: Схема сериализуется в нативный формат через генератор. Интерфейс строит нативная фабрика -->

<!-- Единицы измерения -->
	<units>
		<unit id="mhz_ut">
			<unit multiplier="1000000" name="МГц" name_en="MHz"/>
			<unit multiplier="1000" name="КГц" name_en="KHz"/>
			<unit multiplier="1" name="Гц" name_en="Hz"/>
		</unit>
	</units>


	<types>
<!-- опишем простые типы, чтобы их можно было найти -->	
		<type id="string" type="base" />
		<type id="float" type="base" />
		<type id="u8" type="base" />
		<type id="s8" type="base" />
		<type id="u16" type="base" />
		<type id="s16" type="base" />
		<type id="u32" type="base" />
		<type id="s32" type="base" />
		
		

		<type id="on_off_t" type="enum">
			<enum id="ON" name="Вкл." name_en="ON" value="0"  />
			<enum id="OFF" name="Выкл." name_en="OFF" value="1"  />
		</type>
		<type id="StartMeasure" type="enum">
			<enum id="Start" name="Старт" name_en="Start" value="0" />
			<enum id="Stop" name="Стоп" name_en="Stop" value="1" />
		</type>
		<type id="ChSuffix" type="enum">
			<enum id="X" name="X" value="0" />
			<enum id="Y" name="Y" value="1" />
		</type>
		<type id="PulseShape" type="enum">
			<enum id="Gauss" name="Гаусовый" name_en="Gauss" value="0" />
			<enum id="Square" name="Прямоуг." name_en="Square" value="1" />
		</type>
		<type id="BaseFunction" type="enum">
			<enum id="Interrogator" name="Запросчик" name_en="Interrogator" value="0"  />
			<enum id="Transponder" name="Приемоответчик" name_en="Transponder" value="1"  />
		</type>
		<type id="GeneratorOutput" type="enum">
			<enum id="Antenna" name="Антенна" name_en="Antenna" value="0"  />
			<enum id="Attenuator" name="Аттенюатор" name_en="Attenuator" value="1"  />
		</type>
		<type id="ScreenOff" type="enum">
			<enum id="OneMin" name="1мин" name_en="OneMin" value="0" />
			<enum id="TwoMin" name="2мин" name_en="TwoMin" value="1" />
			<enum id="FiveMin" name="5мин" name_en="FiveMin" value="2" />
			<enum id="HalfHour" name="30мин" name_en="HalfHour" value="3" />
			<enum id="Never" name="Никогда" name_en="Never" value="4" />
		</type>
		<type id="TriggerSource" type="enum">
			<enum  id="Squitter" name="ХИП" name_en="Squitter" value="0" />
			<enum  id="Pulse" name="Пачка" name_en="Pulse" value="1"  />
			<enum  id="External" name="Внеш" name_en="External" value="2" />
		</type>
		<type id="lang_t" type="enum">
			<enum id="RU" name="Русский" name_en="Russian" value="0"  />
			<enum id="EN" name="Английский" name_en="English" value="1"  />
		</type>
		
		<type id="dme_t" name="Канал DME" name_en="DME Channel" type="complex">
			<parameter id="ChNumber" name="Канал" name_en="Channel" type="u8" validator="range" lo="1" hi="126" initial="64" increment="1" view="tbox" />
			<parameter id="ChSuffix"  name="Суффикс" name_en="Suffix" type="ChSuffix" initial="0" view="cbox" />
		</type>
		<type id="co_t" name="СО" name_en="Id" type="complex">
			<parameter id="DotLength" label="мкс" label_en="us" name="Длина точки" name_en="Dot Length" type="float" validator="range" lo="0.0" hi="100.0" initial="12.0" increment="0.1" view="tbox_label" />
			<parameter id="PauseLength" label="мкс" label_en="us" name="Длина пробела" name_en="Pause Length" type="float" validator="range" lo="0.0" hi="100.0" initial="12.0" increment="0.1" view="tbox_label" />
			<parameter id="InsrertPulses"  name="Выравнивающий импульс" name_en="Compensation Pulse" type="on_off_t" initial="0" view="cbox" />
			<parameter id="Period" label="c" label_en="s" name="Период СО" name_en="ID Period" type="s32" validator="range" lo="10" hi="100" initial="40" increment="1" view="tbox_label" />
		</type>
		<type id="display_t" name="Дисплей" name_en="Display" type="complex">
			<parameter id="ScreenBrightness" label="%" label_en="%" name="Яркость" name_en="Brightness" type="u32" validator="range" lo="0" hi="100" initial="100" increment="10" view="tbox_label" />
			<parameter id="ScreenOff"  name="Отключение дисплея" name_en="Screen Off" type="ScreenOff" initial="4" view="cbox" />
		</type>
		<type id="version_t" name="Информация о версии" name_en="Version info" type="complex">
			<parameter id="disp_fw_ver" name="Версия ПО дисп." name_en="Disp. fw ver" type="u32" view="param_value_label" />
			<parameter id="host_fw_ver" name="Версия ПО хоста" name_en="Host fw ver" type="u32" view="param_value_label" />
			<parameter id="schema_ver" name="Версия схемы UI" name_en="UI schema ver" type="u32" view="param_value_label" />
			<parameter id="fonts_ver" name="Версия шрифтов" name_en="Fonts ver" type="u32" view="param_value_label" />
		</type>
		
	</types>
	
	<parameters>
		<parameter id="RfStatus" type="on_off_t" initial="1" name="RF"  />
		<parameter id="SelfTest" type="on_off_t" initial="0" name="TST" />
	
		<parameter id="DmeFrequency" label="МГц" label_en="MHz" type="float" validator="range" lo="900.0" hi="1500.0" initial="1080.0" increment="1.0" view="tbox_label" />
		<parameter id="RfLevel" label="дБВт" label_en="dBW" type="s32" validator="range" lo="-130" hi="33" initial="0" increment="1"  view="tbox_label" />
		
		<parameter id="StartMeasure" type="StartMeasure"  name="Измерение" name_en="Measurement" initial="0" view="cbox" />
		
		<parameter id="Distance" label="м" label_en="m" name="Дальность" name_en="Distance" type="s32" validator="range" lo="-5000" hi="5000" initial="0" view="param_value_label" />
		<parameter id="Efficiency" label="%" label_en="%" name="Эффективность" name_en="Efficiency" type="s32" validator="range" lo="0" hi="100" initial="0" increment="1" view="param_value_label" />
		<parameter id="IdCode" name="Код СО" name_en="Code ID" type="string"  view="param_value_label" />
		
		<parameter id="PulseRf" label="дБВт" label_en="dbW" name="Уровень ВЧ" name_en="RF Level" type="s32" initial="0" increment="1" view="param_value_label" />
		<parameter id="PulseWidth" label="мкс" label_en="us" name="Длительность импульса" name_en="Pulse width" type="float" validator="range" lo="2.5" hi="5.0" initial="3.5" increment="0.1" view="param_value_label" />
		<parameter id="PulseRise" label="мкс" label_en="us" name="Фронт инпульса" name_en="Pulse Rise" type="float" validator="range" lo="1.5" hi="3.5" initial="2.5" increment="0.1" view="param_value_label" />
		<parameter id="PulseFall" label="мкс" label_en="us" name="Спад импульса" name_en="Pulse Fall" type="float" validator="range" lo="1.5" hi="3.5" initial="2.5" increment="0.1" view="param_value_label" />
		<parameter id="SpanReply" label="мкс" label_en="us" name="Интервал ответа" name_en="Span Reply" type="float" validator="range" lo="11.0" hi="13.0" initial="12.0" increment="0.1" view="param_value_label" />
		<parameter id="PairPowerDiff" label="дБ" label_en="dB" name="Разность в паре" name_en="Diffirence in Pair" type="float" validator="range" lo="-1.0" hi="1.0" initial="0.0" view="param_value_label" />

		<parameter id="DmeChannel" name="Канал DME" name_en="DME Channel" type="dme_t" />
		
		<parameter id="PulseShape"  name="Форма" name_en="Shape" type="PulseShape" initial="0" view="cbox" />
		<parameter id="RequestSpan" label="мкс" label_en="us" name="Интервал запроса" name_en="Span Request" type="float" validator="range" lo="0.0" hi="100.0" initial="12.0" increment="0.1" view="tbox_label" />
		<parameter id="TriggerFrequency" label="Гц" label_en="Hz" name="Число запросов" name_en="Request Count" type="u32" validator="range" lo="0" hi="5000" initial="50" increment="1" view="tbox_label" />
		<parameter id="TriggerSource"  name="Запуск" name_en="Trigger" type="TriggerSource" initial="1" view="cbox" />

		<parameter id="Id" name="СО" name_en="Id" type="co_t" />
		
		<parameter id="BaseFunction"  name="Режим ГСПН-2" name_en="DME Analyser Mode" type="BaseFunction" initial="0" view="cbox" />
		<parameter id="GeneratorOutput"  name="Выход" name_en="Output" type="GeneratorOutput" initial="1" view="cbox" />
		
		<parameter id="Display" name="Дисплей" name_en="Display" type="display_t" />
		
		<parameter id="Calibration"  name="Калибровка" name_en="Calibration" type="s32" view="calib_btn" />
		<parameter id="lang" name="Язык" name_en="Language" type="lang_t" initial="0" view="cbox" />
		<parameter id="version" name="Версия ПО" name_en="SW Version" type="version_t" />
		
	</parameters>
	
	<colors>
		<color id="BK_WHITE" hex="0xF9FFF4"/>
		<color id="BK_BLUE" hex="0x679AB9"/>
		<color id="BK_GRAY" hex="0x97A39F"/>
		<color id="FNT_WHITE" hex="0xE5E9F2"/>
		<color id="SELECTED" hex="0xAFBFCF"/>
		<color id="CAPTURED" hex="0x267F00"/>
		<color id="INVALID" hex="0xFF0000"/>
		<color id="BLACK" hex="0x000000"/>
	</colors>
	
	<fonts>
		<font id="TTF" name="ARIALN.TTF" default="true" />
		<font id="TTF_BOLD" name="ARIALNB.TTF" />
		<font id="GLY" name="glyphs.ttf" />
	</fonts>
	
	<font_sizes>
		<font_size id="FS_8" value="12" />
		<font_size id="FS_15" value="16" />
		<font_size id="FS_20" value="21" default="true"/>
		<font_size id="FS_30" value="30" />
	</font_sizes>

	<views>
<!-- предопределенные (в коде) виды. Для них также создается мета -->
		<view id="lab" controller="lab" predefined="lab" font="TTF" font_size="FS_30" /> <!-- label -->
		
		<view id="tbox" predefined="tbox" controller="tbox" font_size="FS_30" decorator="background,3d" min_width="100" max_width="100"
			default_color="BK_WHITE" selected_color="SELECTED" captured_color="CAPTURED" invalid_color="INVALID" /> <!-- textbox -->
			
		<view id="cbox" predefined="cbox" controller="cbox" font_size="FS_30" decorator="background,3d,cbox" 
			default_color="BK_WHITE" selected_color="SELECTED" captured_color="CAPTURED" /> <!-- combobox -->
			
		<view id="btn" controller="btn" predefined="btn" layout="center" padding="10"
			decorator="background,3d" d3_inversed="true"  default_color="BK_WHITE" selected_color="SELECTED" > <!-- button \-->
			<view inherited="lab" font_size="FS_20" />
		</view>
<!-- textbox + combobox -->		
		<view id="tbox_cbox" layout="stack" vertical="false" > 
			<view inherited="tbox" />
			<view inherited="cbox" />
		</view>
<!-- textbox + label -->
		<view id="tbox_label" layout="stack" vertical="false" >
			<view inherited="tbox" />
			<view inherited="lab" text_source="label" /> <!-- взять значение label из аттрибута label, а не name -->
		</view>
		<view id="param_value_label" inherited="lab" predefined="lab_focusable" dynamic_source="parameter_value"  />
		
		
		<view id="status_label" layout="center" propagate="parameter_path" >
			<view layout="stretch" padding="2" propagate="parameter_path" decorator="background,box" default_color="BK_WHITE" box_color="BLACK">
				<view layout="stack" vertical="false" propagate="parameter_path" >
					<view inherited="lab" text_source="name" font_size="FS_8" />
					<view inherited="lab" dynamic_source="parameter_value" font_size="FS_8" /> <!-- взять значение label из значения связанного параметра -->
				</view>	
			</view>
		</view>

		<view id="calib_btn" inherited="btn" static_text="Выполнить" static_text_en="Go" propagate="static_text" />

<!-- генерируемые виды -->
		
		<view id="default_composite_template" layout="stack" vertical="true" />
<!-- propagate - передать параметр непосредственным детям-->

		<view id="root" layout="stretch" padding="5" decorator="background" default_color="BK_GRAY">
			<view layout="stack" vertical="true"  stretch="last" >
				<view layout="stack" vertical="false" stretch="last" >
					<view layout="stretch" controller="parameter_view" parameter_path="DmeFrequency"/> 
					<view layout="stretch" controller="parameter_view" parameter_path="RfLevel"/> 

					<view layout="right_bottom" vertical="false">
						<view layout="stack" vertical="false">
							<view inherited="status_label" parameter_path="RfStatus" propagate="parameter_path" />
							<view inherited="status_label" parameter_path="SelfTest" propagate="parameter_path" />
						</view>
					</view>
				</view>

				<view layout="stack" vertical="true"  stretch="last">
					<view decorator="background" default_color="BK_BLUE" layout="stretch">
						<view inherited="lab" static_text="xxx" listen="menu_name" font="TTF_BOLD" font_size="FS_15" font_color="FNT_WHITE"  /> 
					</view>
					<view layout="stretch" decorator="background" default_color="BK_GRAY" > <!-- to stop dirty propagation -->
						<view predefined="scroll_window" >
		<!-- параметры event, listen, arg0 - посылка сообщения по локальной шине сообщений -->
							<view layout="stretch" padding="10" controller="window_selector" listen="menu_select" name_event="menu_name" >
								<view id="main" name="Главное" name_en="Main" layout="center" >
									<view layout="stack" vertical="false" preferred_item_size="false" bw="140" height="80" >
										<view layout="center" decorator="background" default_color="BK_BLUE" >
											<view inherited="btn" static_text="Управление" static_text_en="Control" propagate="static_text" event="menu_select" arg0="control" />
										</view>
										<view layout="center" decorator="background" default_color="BK_BLUE">
											<view inherited="btn" static_text="Калибровка" static_text_en="Calibration" propagate="static_text" event="menu_select" arg0="parameters" />
										</view>
										<view layout="center" decorator="background" default_color="BK_BLUE">
											<view inherited="btn" static_text="Настройки" static_text_en="Settings" propagate="static_text" event="menu_select" arg0="settings" />
										</view>
									</view>
								</view>
								<view id="control" inherited="menu_page_template" name="Управление" name_en="Control" menu_ref="control" />
								<view id="parameters" inherited="menu_page_template" name="Калибровка" name_en="Calibration" menu_ref="parameters" />
								<view id="settings" inherited="menu_page_template" name="Настройки" name_en="Settings" menu_ref="settings"  />
							</view>
						</view>
					</view>
				</view>
			</view>
		</view>
		
		<view id="menu_page_template" item_template_view="menu_item" item_template_view_complex="menu_item_complex" layout="stack" vertical="true"  controller="menu" />

<!--
		<view id="foo_popup" layout="center">
			<view  layout="center"  decorator="background" default_color="BK_BLUE" width="300" height="200" >
				<view  layout="stack" vertical="true"  >
					<view  inherited="lab" static_text="Сообщение 1" />
					<view  inherited="btn" static_text="Закрыть" propagate="static_text" close="true" />
				</view>
			</view>
		</view>
-->		
		
		<view id="popup_menu" layout="center">
			<view layout="stretch" padding="5" decorator="background, 3d" default_color="BK_GRAY" d3_inversed="true" width="400" height="200" >
				<view  layout="stack" vertical="true" stretch="1" >
					<view decorator="background" default_color="BK_BLUE" layout="stretch">
						<view inherited="lab" static_text="xxx" listen="popup_menu_name" font="TTF_BOLD" font_size="FS_15" font_color="FNT_WHITE"  /> 
					</view>
					<view predefined="scroll_window" >
						<view layout="stretch" padding="10" >
							<view inherited="menu_page_template" controller="popup_menu" name_event="popup_menu_name" /> 
						</view>
					</view>
					<view layout="center">
						<view inherited="btn" static_text="Закрыть" static_text_en="Close" propagate="static_text" close="true" />
					</view>
				</view>
			</view>
		</view>

		<view id="reboot_popup" layout="center">
			<view  layout="center" padding="5" decorator="background" default_color="BK_BLUE" height="200" >
				<view  layout="stack" vertical="true"  >
					<view layout="center">
						<view  inherited="lab" static_text="Требуется перезагрузка" static_text_en="Going to be rebooted" />
					</view>
					<view layout="center">
						<view  inherited="btn" static_text="Перезагрузить" static_text_en="Reboot" propagate="static_text" event="reboot" arg0="0" close="true" />
					</view>
				</view>
			</view>
		</view>
		
		<view id="menu_item_complex" layout="stack" vertical="false" >
			<view inherited="btn" text_source="name" propagate="text_source" popup_view="popup_menu" />
		</view>
		<view id="menu_item" layout="menu_item" ratio="0.5">
			<view inherited="lab" font_size="FS_20" text_source="name" /> <!-- взять параметр "name" из меты параметра -->
			<!-- элемент меню вставляется дочерним видом (реализация зависит от контроллера меню) -->
		</view>
	</views>
	
	<menus>
		<menu id="control">
			<parameter_ref id="StartMeasure" />
			<parameter_ref id="DmeChannel" />
			<parameter_ref id="PulseShape" />
			<parameter_ref id="RequestSpan" />
			<parameter_ref id="TriggerFrequency" />
			<parameter_ref id="TriggerSource" />
			<parameter_ref id="Id" />
			<parameter_ref id="BaseFunction" />
			<parameter_ref id="GeneratorOutput" />
		</menu>
		<menu id="parameters">
			<parameter_ref id="Distance" />
			<parameter_ref id="Efficiency" />
			<parameter_ref id="IdCode" />
			<parameter_ref id="PulseRf" />
			<parameter_ref id="PulseWidth" />
			<parameter_ref id="PulseRise" />
			<parameter_ref id="PulseFall" />
			<parameter_ref id="SpanReply" />
			<parameter_ref id="PairPowerDiff" />
			<parameter_ref id="Calibration" />
		</menu>
		<menu id="settings">
			<parameter_ref id="Display" />
			<parameter_ref id="lang" />
			<parameter_ref id="version" />
		</menu>
	</menus>
</schema>