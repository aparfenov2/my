<schema>

<!-- Генерация UI: Схема сериализуется в нативный формат через генератор. Интерфейс строит нативная фабрика -->

<!-- Единицы измерения -->
	<units>
		<unit id="mhz_ut">
			<unit multiplier="1000000" name="MHz"/>
			<unit multiplier="1000" name="KHz"/>
			<unit multiplier="1" name="Hz"/>
		</unit>
	</units>


	<types>
<!-- опишем простые типы, чтобы их можно было найти -->	
		<type id="string" type="base" />
		<type id="float" type="base" />
		<type id="u8" type="base" />
		<type id="s8" type="base" />
		<type id="u16" type="base" />
		<type id="s16" type="base" />
		<type id="u32" type="base" />
		<type id="s32" type="base" />
		
		<type id="dme_sfx_t" name="Суффикс DME" type="enum">
			<enum id="X" name="X" value="0" />
			<enum id="Y" name="Y" value="1" />
		</type>
		
		<!-- Использование полей параметра комплексного типа полностью определяется контроллером -->
		<!-- поэтому здесь для полей вид не указан -->
		<type id="dme_t" name="Параметры DME" type="complex">
			<parameter id="ch" name="Канал DME" type="u8" validators="range" initial="127" lo="-127" hi="128" />
			<parameter id="sfx" name="Суффикс DME" type="dme_sfx_t" initial="0" />
		</type>
		<type id="measure_ctl_t" name="Измерение" type="enum">
			<enum id="START" name="Старт" value="0" />
			<enum id="STOP" name="Стоп" value="1" />
		</type>
		<type id="output_mode_t" name="Выход" type="enum">
			<enum id="ANT" name="Антенна" value="0" glyph="A" />
			<enum id="ATTEN" name="Аттен." value="1" glyph="B" />
			<enum id="CALIB" name="Калибр." value="2" glyph="C" />
		</type>
		<type id="start_ctl_t" name="Запуск" type="enum">
			<enum id="HIP" name="ХИП" value="0" glyph="A" />
			<enum id="CALIB" name="Пачка" value="1" glyph="B" />
			<enum id="EXT" name="Внеш" value="2" glyph="C" />
		</type>
		<type id="mode_ctl_t" name="Режим" type="enum">
			<enum id="REQESTER" name="Запросчик" value="0" glyph="A" />
			<enum id="RESPONDER" name="Ответчик" value="1" glyph="B" />
		</type>
	</types>
	
	<parameters>
<!-- Главное -->	
		<parameter id="dme" type="dme_t"  name="Параметры DME" view="dme"  />
		<parameter id="measure_ctl" type="measure_ctl_t"  name="Измерение" initial="0" />
		<parameter id="output_mode" type="output_mode_t"  name="Выход" initial="0"  />
		<parameter id="out_level" type="float" precision="0.1" validators="range" lo="-70" hi="70" initial="72.3"  name="Уровень" label="dBm" view="tbox_label" />
		<parameter id="start_ctl" type="start_ctl_t"  name="Запуск" initial="0"  />
		
<!-- Параметры -->	
		<parameter id="req_period" type="u32" name="Период запросов" initial="1300" label="Имп. пар\\с" view="tbox_label" />
		<parameter id="req_freq" type="float" name="Частота запроса" initial="1050.20" label="Мгц" view="tbox_label" />
		<parameter id="req_span" type="float" name="Кодовый интервал запроса" initial="12.0" label="мкс" view="tbox_label" />
		<parameter id="rsp_span" type="float" name="Кодовый интервал ответа" initial="12.0" label="мкс" view="tbox_label" />
		<parameter id="mode_ctl" type="mode_ctl_t"  name="Режим" initial="0"  />
	</parameters>
	
<!-- предопределенные контроллеры -->	
	<controllers>
		<controller id="menu"/>
		<controller id="menu_item"/>
		<controller id="dme"/>
	</controllers>

	<views>
<!-- предопределенные (в коде) виды. Для них также создается мета -->
		<view id="tbox" controller="tbox" kind="predefined" /> <!-- textbox -->
		<view id="cbox" controller="cbox" kind="predefined" /> <!-- combobox -->
		<view id="lab" controller="lab" kind="predefined" /> <!-- label -->
		
<!-- textbox + combobox -->		
		<view id="tbox_cbox" layout="stack" vertical="false" preferred_item_size="true"> 
			<view id="tbox" inherited="tbox" />
			<view id="cbox" inherited="cbox" />
		</view>
<!-- textbox + label -->
		<view id="tbox_label" layout="stack" vertical="false" preferred_item_size="true">
			<view id="tbox" inherited="tbox" />
			<view id="lab" inherited="lab" labelSource="label" /> <!-- взять значение label из аттрибута label, а не name -->
		</view>


<!-- генерируемые виды -->
		<view id="dme" layout="stack" vertical="false" preferred_item_size="true" > 
			<view id="ch" inherited="tbox" parameterPath=".ch" /> <!-- относительный путь внутри параметра dme -->
			<view id="sfx" inherited="cbox" parameterPath=".sfx" />
		</view>

		
		<view id="default_composite_template" layout="stack" vertical="true"/>
		
		<view id="root" layout="stack" vertical="true" preferred_item_size="true" drawer="background" background="BACKGROUND_LIGHT" >
			<view id="header" layout="stack" vertical="true" preferred_item_size="true" >
				<view id="lab1" inherited="lab" staticText="Статичный заголовок 1" /> <!-- сюда юудет выводиться название текущего меню -->
				<view id="lab2" inherited="lab" staticText="Статичный заголовок 2" />
				<view id="lab3" inherited="lab" staticText="Статичный заголовок 3" />
				<view id="lab4" inherited="lab" staticText="Статичный заголовок 4" />
				<view id="lab5" inherited="lab" staticText="Статичный заголовок 5" />
				<view id="lab5" inherited="lab" staticText="Статичный заголовок 6" />
				<view id="lab5" inherited="lab" staticText="Статичный заголовок 7" />
			</view>
		<!-- по id внутренних видов их можно искать в инстансе динамического вида-->
		<!-- контроллер меню достраивает вид меню по списку параметров -->
			<view id="scroll_window" kind="predefined" >
				<view id="scroll_interior" layout="stretch" >
					<view id="window_selector" initial="main" layout="stack" vertical="true" preferred_item_size="true" controller="window_selector" nameLabelPath="root.header.lab1">
						<view id="main" name="Главное" menuRef="main" itemTemplateView="menu_item" layout="stack" vertical="true" controller="menu" />
						<view id="parameters" name="Параметры" menuRef="parameters" itemTemplateView="menu_item" layout="stack" vertical="true" controller="menu" />
					</view>
				</view>
			</view>
		</view>
		
		<view id="menu_item" layout="menu_item">
			<view id="lab" inherited="lab" /> <!-- по умолчанию контроллер label выводит параметр "name" из меты параметра -->
			<!-- элемент меню вставляется дочерним видом (реализация зависит от контроллера меню) -->
		</view>
	</views>
	
	<menus>
		<menu id="main" name="Главное">
			<parameterRef id="measure_ctl" />
			<parameterRef id="dme" />
			<parameterRef id="output_mode" />
			<parameterRef id="out_level" />
			<parameterRef id="start_ctl" />
		</menu>
		<menu id="parameters" name="Параметры">
			<parameterRef id="req_period" />
			<parameterRef id="req_freq" />
			<parameterRef id="req_span" />
			<parameterRef id="rsp_span" />
			<parameterRef id="mode_ctl" />
		</menu>
	</menus>
</schema>